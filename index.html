<!DOCTYPE html>
<html>
<head>
    <title>Balance Board Test</title>
    <style>
        body { font-family: sans-serif; text-align: center; background: #222; color: white; }
        #board-visual {
            width: 300px; height: 300px;
            background: linear-gradient(135deg, #00C9FF 0%, #92FE9D 100%);
            margin: 50px auto;
            border-radius: 20px;
            box-shadow: 0 0 50px rgba(0,255,255,0.2);
            transition: transform 0.05s linear; /* Smooth movement */
        }
        button {
            padding: 15px 30px; font-size: 18px; cursor: pointer;
            background: #ff4757; color: white; border: none; border-radius: 8px;
        }
        #data-display { margin-top: 20px; font-size: 24px; font-family: monospace; }
    </style>
</head>
<body>

    <h1>Balance Board Controller</h1>
    <button id="connectBtn">CONNECT BOARD</button>
    
    <div id="data-display">Not Connected</div>

    <div id="board-visual">
        <div style="padding-top:130px; font-weight:bold; color:black;">FRONT</div>
    </div>

    <script>
        const serviceUUID = "19b10000-e8f2-537e-4f6c-d104768a1214";
        const charUUID    = "19b10001-e8f2-537e-4f6c-d104768a1214";
        let device, server, service, characteristic;

        const connectBtn = document.getElementById('connectBtn');
        const display = document.getElementById('data-display');
        const visual = document.getElementById('board-visual');

        connectBtn.addEventListener('click', async () => {
            try {
                // 1. Scan for Device
                device = await navigator.bluetooth.requestDevice({
                    filters: [{ name: 'BalanceBoard' }],
                    optionalServices: [serviceUUID]
                });

                // 2. Connect
                display.innerText = "Connecting...";
                server = await device.gatt.connect();
                service = await server.getPrimaryService(serviceUUID);
                characteristic = await service.getCharacteristic(charUUID);

                // 3. Start Notifications (Listen for data)
                await characteristic.startNotifications();
                characteristic.addEventListener('characteristicvaluechanged', handleData);
                
                display.innerText = "Connected! Move your board.";
                connectBtn.style.display = 'none';

            } catch (error) {
                console.error(error);
                alert("Connection Failed: " + error);
            }
        });

        function handleData(event) {
            const value = event.target.value;
            
            // Read 16-bit integers (Little Endian)
            const pitchInt = value.getInt16(0, true);
            const rollInt  = value.getInt16(2, true);
            
            // Convert back to float
            const pitch = - pitchInt / 100.0;
            const roll  = rollInt / 100.0;

            // Update Text
            display.innerText = `Pitch: ${pitch.toFixed(1)}° | Roll: ${roll.toFixed(1)}°`;

            // Update Visual 3D Transform
            visual.style.transform = `perspective(500px) rotateX(${pitch}deg) rotateY(${roll}deg)`;
        }
    </script>
</body>
</html>
